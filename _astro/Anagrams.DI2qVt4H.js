import{n as k,c as b,m as ke,o as oe,q as F,g as d,t as u,i,e as w,k as ie,a as $,d as Te,v as ye,b as p,l as A,w as Ce,F as Z,S as Q,p as ee,r as te,u as Ee}from"./web.CNe7Nk8j.js";import{u as Le}from"./use-has-mounted.CxY7pale.js";import{l as Re}from"./index.D4smDMuB.js";import{B as ne}from"./Button.DD7DXf63.js";import"./store.CbzdVTv2.js";const B=(e,t,s)=>{const n=s(e,t);return oe(()=>clearInterval(n))},Ue=(e,t,s)=>{if(typeof t=="number"){B(e,t,s);return}let n=!1,r=performance.now(),l=0,c=!1;const g=()=>{F(e),r=performance.now(),n=s===setTimeout};ke(S=>{if(n)return;const _=t();if(_===!1)return S&&(l+=(performance.now()-r)/S),_;if(S===!1&&(r=performance.now()),c){if(S&&(l+=(performance.now()-r)/S),r=performance.now(),l>=1)l=0,g();else if(l>0){const[R,v]=b(void 0,{equals:!1});return R(),B(()=>{l=0,c=!1,v(),g()},(1-l)*_,setTimeout),_}}return c=!0,B(g,_,s),_})};function Ne(e,t,s,n){const r=k(()=>b(e(s),n));return Ue(()=>r()[1](e),t,setInterval),()=>r()[0]()}const ce=6e4,re=36e5,se=e=>e instanceof Date?e:new Date(e),De=(e,t)=>t.getTime()-e.getTime(),G={equals:!1},Me=e=>typeof e=="function"&&!e.length?e():e;function Oe(e,...t){return typeof e=="function"?e(...t):e}const Ie=(e,t)=>e.length>0?()=>e(F(t)):e;function We(e,t){let s=0;const n=e.map((r,l)=>k(()=>(s=l,r()),void 0,G));return k(()=>n.map(r=>r())[s],void 0,t)}function Ae(e,t,s){let n=()=>t;const[r,l]=b(t,G),c=k(Ie(e,()=>n()),t,G);return[n=We([r,c],s),(g=>l(()=>typeof g=="function"?g(F(n)):g))]}const ae=e=>{const[t,s]=Ae(()=>se(Me(e)));return[t,r=>s(l=>se(Oe(r,l)))]};function Be(e=ce/2){const[t,s]=b(void 0,{equals:!1});return[Ne(()=>(t(),new Date),e,void 0,{equals:(r,l)=>r.getTime()===l.getTime()}),s]}function Ge(e,t){const[s]=ae(e),[n]=ae(t);return[k(()=>De(s(),n())),{from:s,to:n}]}function Fe(e,t=s=>Math.abs(s)<=re?ce/2:re/2){const s=typeof t=="function"?()=>t(l()):t,[n,r]=Be(s),[l,{to:c}]=Ge(n,e);return[l,{update:r,target:c,now:n}]}const He=(e,t,s=[])=>{const n=new WebSocket(e,t),r=n.send.bind(n);return n.send=l=>n.readyState==1?r(l):s.push(l),n.addEventListener("open",()=>{for(;s.length;)r(s.shift())}),n};async function Pe(e){const t=await fetch(e);if(!t.ok)throw new Error(`Network response not OK! ${t.status} ${t.statusText} - ${await t.text()}`);return t.json()}var qe=u("<div>");function Je(e){return(()=>{var t=d(qe);return i(t,()=>e.children),w(()=>ie(t,`rounded-2xl bg-stone-200 dark:bg-slate-700 ${e.class??""}`)),t})()}var je=u('<fieldset><legend class="font-heading mx-auto rounded-xl bg-stone-100 px-4 py-2 font-bold dark:bg-slate-800"></legend><!$><!/>');function le(e){return(()=>{var t=d(je),s=t.firstChild,n=s.nextSibling,[r,l]=$(n.nextSibling);return i(s,()=>e.title),i(t,()=>e.children,r,l),w(()=>ie(t,`rounded-3xl bg-stone-100 p-6 pt-2 dark:bg-slate-800 ${e.class??""}`)),t})()}var Ke=u("<label for=public-rooms-url class=select-none>Public Room List URL"),ze=u('<input id=public-rooms-url type=text class="mb-3 w-full rounded-xl border-b-2 border-stone-50 bg-stone-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),Ve=u('<div class="mt-6 space-y-3">'),Xe=u("<label for=server-url class=select-none>Server URL (Connection: <!$><!/>)"),Ye=u('<input id=server-url type=text class="mb-3 w-full rounded-xl border-b-2 border-stone-50 bg-stone-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),Ze=u('<div class="my-3 flex flex-col items-center rounded-lg p-2"><p class="font-mono text-sm font-bold"><!$><!/> - <!$><!/></p><code class=text-4xl>'),Qe=u('<div class="h-60 overflow-y-auto rounded-xl bg-stone-200 p-3 break-all whitespace-pre-line inset-shadow-xs sm:h-80 dark:bg-slate-900 dark:text-slate-200">'),et=u('<input type=text placeholder="message/answer here, send with Enter"class="mt-3 w-full rounded-xl border-b-2 border-stone-50 bg-stone-200 p-2 inset-shadow-xs placeholder:text-stone-500 dark:border-slate-700 dark:bg-slate-900 dark:placeholder:text-slate-500">'),tt=u("<p class=text-center>Loading rooms..."),nt=u("<p class=text-center>Currently no rooms"),rt=u("<span> | <!$><!/>"),st=u("<span> | <!$><!/>/<!$><!/> rounds left"),at=u('<div class="flex items-center justify-between"><div class="py-1.5 font-mono text-sm wrap-anywhere"><span><!$><!/> | <!$><!/> players</span><!$><!/><!$><!/></div><button class="font-heading ml-3 cursor-pointer p-3 font-semibold underline">'),lt=u("<div>");function ft(){const[e,t]=Re,s=()=>e.anagramsRoomListUrl??"https://mc.chenk.my.id:3000/anagram",n=()=>e.anagramsServerUrl??"wss://mc.chenk.my.id:3000/ws/anagram/1",[r,l]=b("Not Connected");let c,g;oe(()=>{c&&c.close()});const[S,_]=b("WAITING ROUND START!"),[R,v]=b(""),[de,T]=b(""),[H]=Fe(de,()=>100),[y,P]=b(""),[ue,q]=b([]),J=a=>{const{type:o,content:m}=JSON.parse(a.data);switch(o){case"ChatMessage":q(f=>[...f,m]),setTimeout(()=>{g&&(g.scrollTop=g.scrollHeight)});break;case"OngoingRoundInfo":T(m.round_finish_time),_("PLEASE GUESS!"),v(m.word_to_guess);break;case"FinishedRoundInfo":T(m.to_next_round_time),_("TIME'S UP! THE ANSWER:"),v(m.word_answer);break;case"FinishedGame":T(""),_("WAITING ROUND START!"),v("")}},j=()=>{l("Open")},K=()=>{r()==="Not Connected"||r()==="Closed"?(c=He(n()),l("Connecting"),c.addEventListener("open",j),c.addEventListener("message",J)):(l("Closing"),c?.removeEventListener("open",j),c?.removeEventListener("message",J),c?.close(),l("Closed"),T(""),_("WAITING ROUND START!"),v(""))},fe=a=>{a.key==="Enter"&&(y()==="/clear"?q([]):y().trim()!==""&&c?.send(y()),P(""))},z=Le(),[me,ge]=ye(s,Pe);return[p(le,{title:"PUBLIC ROOMS",class:"mx-3 mt-6 min-h-60",get children(){return[d(Ke),(()=>{var a=d(ze);return a.addEventListener("change",o=>t("anagramsRoomListUrl",o.currentTarget.value)),w(()=>A(a,"value",z()?s():"Loading saved URL...")),a})(),p(ne,{variant:"secondary",class:"w-full",onClick:()=>{ge.refetch()},children:"Refresh"}),(()=>{var a=d(Ve);return i(a,p(Ce,{get fallback(){return d(tt)},get children(){return p(Z,{get each(){return me()},get fallback(){return d(nt)},children:o=>p(Je,{class:"pl-3",get children(){var m=d(at),f=m.firstChild,h=f.firstChild,U=h.firstChild,[C,N]=$(U.nextSibling),D=C.nextSibling,M=D.nextSibling,[E,_e]=$(M.nextSibling);E.nextSibling;var $e=h.nextSibling,[V,pe]=$($e.nextSibling),be=V.nextSibling,[he,xe]=$(be.nextSibling),X=f.nextSibling;return i(h,()=>o.room_id,C,N),i(h,()=>o.player_count,E,_e),i(f,p(Q,{get when(){return o.current_dictionary},get children(){var x=d(rt),O=x.firstChild,I=O.nextSibling,[L,W]=$(I.nextSibling);return i(x,()=>o.current_dictionary,L,W),x}}),V,pe),i(f,p(Q,{get when(){return ee(()=>o.current_game_rounds_left!==null)()&&o.current_game_round_count!==null},get children(){var x=d(st),O=x.firstChild,I=O.nextSibling,[L,W]=$(I.nextSibling),Se=L.nextSibling,ve=Se.nextSibling,[Y,we]=$(ve.nextSibling);return Y.nextSibling,i(x,()=>o.current_game_rounds_left,L,W),i(x,()=>o.current_game_round_count,Y,we),x}}),he,xe),X.$$click=()=>{t("anagramsServerUrl",n()),K()},i(X,()=>r()==="Open"&&o.room_id===n().split("/").pop()?"Leave":"Join"),te(),m}})})}})),a})()]}}),p(le,{title:"GAME",class:"mx-3 mt-6 min-h-64",get children(){return[(()=>{var a=d(Xe),o=a.firstChild,m=o.nextSibling,[f,h]=$(m.nextSibling);return f.nextSibling,i(a,r,f,h),a})(),(()=>{var a=d(Ye);return a.addEventListener("change",o=>t("anagramsServerUrl",o.currentTarget.value)),w(()=>A(a,"value",z()?n():"Loading saved URL...")),a})(),p(ne,{class:"w-full",onClick:K,get children(){return typeof r<"u"&&r()==="Open"?"Disconnect":"Connect"}}),(()=>{var a=d(Ze),o=a.firstChild,m=o.firstChild,[f,h]=$(m.nextSibling),U=f.nextSibling,C=U.nextSibling,[N,D]=$(C.nextSibling),M=o.nextSibling;return i(o,S,f,h),i(o,(()=>{var E=ee(()=>!!isNaN(H()));return()=>E()?"":`${Math.max(0,H()/1e3).toFixed(1)} secs`})(),N,D),i(M,R),a})(),(()=>{var a=d(Qe),o=g;return typeof o=="function"?Ee(o,a):g=a,i(a,p(Z,{get each(){return ue()},children:m=>(()=>{var f=d(lt);return i(f,m),f})()})),a})(),(()=>{var a=d(et);return a.addEventListener("change",o=>P(o.currentTarget.value)),a.$$keyup=fe,w(()=>A(a,"value",y())),te(),a})()]}})]}Te(["keyup","click"]);export{ft as default};
