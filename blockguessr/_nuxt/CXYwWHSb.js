import{d as V,r,o as E,a0 as R,v as _,a1 as X,i as F,E as W,t as v,x as l,B as N,z as S,A as P,a2 as U,Q as t,y as T,Z as I,$ as D,X as K,Y as H,V as J,a3 as Q,a4 as Y}from"./VM11WSMq.js";import{_ as j}from"./Cd1wEKCZ.js";import{_ as q}from"./BUZ4EKXr.js";import{u as ee,a as ae,b as te}from"./SO4ZUJtz.js";const oe=Symbol.for("nuxt:client-only"),se=V({name:"ClientOnly",inheritAttrs:!1,props:["fallback","placeholder","placeholderTag","fallbackTag"],setup(B,{slots:u,attrs:z}){const x=r(!1);return E(()=>{x.value=!0}),R(oe,!0),f=>{var s;if(x.value)return(s=u.default)==null?void 0:s.call(u);const g=u.fallback||u.placeholder;if(g)return g();const h=f.fallback||f.placeholder||"",i=f.fallbackTag||f.placeholderTag||"span";return _(i,z,h)}}}),ne={class:"space-y-3 px-6"},le={class:"text-center"},re={class:"mx-auto flex w-fit flex-wrap gap-6"},ce={key:0,class:"grid h-[480px] w-[480px] place-items-center bg-zinc-800"},ue={key:1,class:"relative h-[480px] w-[480px]"},ie={class:"absolute left-0 top-0"},de={class:"relative h-[480px] w-[480px] overflow-hidden"},me=["src"],pe="http://mc.pixelsam.me:8100/#world:1500:0:0:2500:0:0:0:1:flat",xe=V({__name:"[id]",setup(B){const u=X(),z=ee("server-link","mc.pixelsam.me:3001"),{status:x,data:f,send:g}=ae(`wss://${z.value}/ws/game/${u.params.id}`,{heartbeat:{message:"/ping",interval:5e3,pongTimeout:5e3}}),h=r("Waiting for game"),i=r(null),s=r(null),d=r(null),M=F(()=>{if(i.value){const{x:e,z:a}=i.value;return`http://mc.pixelsam.me:8100/#world:${e}:70:${a}:0:0:1.5:0:0:free`}if(s.value&&d.value){const e=[s.value,...d.value.map(n=>n.attempt)],a=e.reduce((n,p)=>Math.min(n,p.x),e[0].x),o=e.reduce((n,p)=>Math.max(n,p.x),e[0].x),k=e.reduce((n,p)=>Math.min(n,p.z),e[0].z),y=e.reduce((n,p)=>Math.max(n,p.z),e[0].z),c=Math.round((o+a)/2),C=Math.round((y+k)/2),G=o-a,L=y-k,Z=Math.max(L,G)/2*1.5;return`http://mc.pixelsam.me:8100/#world:${c}:0:${C}:${Z}:0:0:0:1:flat`}return""}),b=r(""),O=te(b,{showSecond:!0,updateInterval:1e3}),w=r(null),m=r(""),$=r([]);W(f,e=>{const{type:a,content:o}=JSON.parse(e);switch(a){case"ChatMessage":$.value.push(o),Y().then(()=>{w.value&&(w.value.scrollTop=w.value.scrollHeight)});break;case"PongMessage":break;case"OngoingRoundInfo":b.value=o.round_finish_time,h.value="Guess",i.value=o.coord_to_guess,s.value=null,d.value=null;break;case"FinishedRoundInfo":b.value=o.to_next_round_time,h.value="Next round starts",i.value=null,s.value=o.coord_answer,d.value=o.coord_attempts;break;case"FinishedGame":b.value="",h.value="Waiting for game",i.value=null,s.value=null,d.value=null;break}});function A(){m.value==="/clear"?$.value=[]:m.value.length>0&&g(m.value),m.value=""}return(e,a)=>{const o=se,k=j,y=q;return v(),_("main",ne,[l("p",{class:U(["mx-auto w-fit px-6 py-3 text-center",t(x)==="OPEN"?"bg-lime-800":"bg-zinc-700"])},[a[1]||(a[1]=N(" Connection: ")),S(o,{fallback:"INITIALIZING"},{default:P(()=>[N(T(t(x)),1)]),_:1})],2),l("p",le,T(t(h))+" "+T(t(O)),1),l("div",re,[t(M)?I("",!0):(v(),_("div",ce,a[2]||(a[2]=[l("p",null,"Waiting for round",-1)]))),t(M)?(v(),_("div",ue,[l("div",ie,[l("div",de,[l("iframe",{src:t(M),class:"absolute bottom-0 h-[530px] w-[480px]"},null,8,me)])]),t(s)&&t(d)?(v(),D(k,{key:0,w:480,h:480,"extra-z-offset":-25,"priority-coord":t(s),locations:t(d).map(c=>({name:c.username,coord:c.attempt})),class:"pointer-events-none absolute left-0 top-0"},null,8,["priority-coord","locations"])):I("",!0)])):I("",!0),l("iframe",{src:pe,class:"h-[480px] w-[480px]"})]),l("div",{ref_key:"chatBox",ref:w,class:"h-60 border-collapse overflow-y-auto whitespace-pre-wrap break-all bg-zinc-800 p-6"},[(v(!0),_(K,null,H(t($),(c,C)=>(v(),_("div",{key:C,class:"border-b border-b-zinc-600"},T(c),1))),128))],512),S(y,{modelValue:t(m),"onUpdate:modelValue":a[0]||(a[0]=c=>J(m)?m.value=c:null),placeholder:"message/answer here, send with Enter",autofocus:"",onKeyup:Q(A,["enter"])},null,8,["modelValue"])])}}});export{xe as default};
