import{q as S,c as u,l as Y,o as B,u as C,k as Z,b as M,g as h,a as v,i as _,d as R,f as Q,r as ee,t as b,v as te,F as ne,j as W}from"./web.CkpDS01l.js";import{B as re}from"./Button.Cp9dh_lE.js";import{l as se,u as oe}from"./index.C0mW4k2g.js";import"./store.C8RApRkK.js";const k=(e,n,s)=>{const t=s(e,n);return B(()=>clearInterval(t))},ae=(e,n,s)=>{if(typeof n=="number"){k(e,n,s);return}let t=!1,o=performance.now(),r=0,l=!1;const m=()=>{C(e),o=performance.now(),t=s===setTimeout};Y(d=>{if(t)return;const g=n();if(g===!1)return d&&(r+=(performance.now()-o)/d),g;if(d===!1&&(o=performance.now()),l){if(d&&(r+=(performance.now()-o)/d),o=performance.now(),r>=1)r=0,m();else if(r>0){const[p,$]=u(void 0,{equals:!1});return p(),k(()=>{r=0,l=!1,$(),m()},(1-r)*g,setTimeout),g}}return l=!0,k(m,g,s),g})};function ce(e,n,s,t){const o=S(()=>u(e(s),t),t);return ae(()=>o()[1](e),n,setInterval),()=>o()[0]()}const F=6e4,I=36e5,A=e=>e instanceof Date?e:new Date(e),le=(e,n)=>n.getTime()-e.getTime(),E={equals:!1},ie=e=>typeof e=="function"&&!e.length?e():e;function de(e,...n){return typeof e=="function"?e(...n):e}const fe=(e,n)=>e.length>0?()=>e(C(n)):e;function ue(e,n){let s=0;const t=e.map((o,r)=>S(()=>(s=r,o()),void 0,E));return S(()=>t.map(o=>o())[s],void 0,n)}function me(e,n,s){let t=()=>n;const[o,r]=u(n,E),l=S(fe(e,()=>t()),n,E);return[t=ue([o,l],s),m=>r(()=>typeof m=="function"?m(C(t)):m)]}const O=e=>{const[n,s]=me(()=>A(ie(e)));return[n,o=>s(r=>A(de(o,r)))]};function ge(e=F/2){const[n,s]=u(void 0,{equals:!1});return[ce(()=>(n(),new Date),e,void 0,{equals:(o,r)=>o.getTime()===r.getTime()}),s]}function pe(e,n){const[s]=O(e),[t]=O(n);return[S(()=>le(s(),t())),{from:s,to:t}]}function he(e,n=s=>Math.abs(s)<=I?F/2:I/2){const s=typeof n=="function"?()=>n(r()):n,[t,o]=ge(s),[r,{to:l}]=pe(t,e);return[r,{update:o,target:l,now:t}]}const _e=(e,n,s=[])=>{const t=new WebSocket(e,n),o=t.send.bind(t);return t.send=r=>t.readyState==1?o(r):s.push(r),t.addEventListener("open",()=>{for(;s.length;)o(s.shift())}),t};var be=b("<label for=server-url class=select-none>Server URL (Connection:<!$><!/>)"),Se=b('<input id=server-url type=text class="mb-3 w-full rounded-xl border-b-2 border-white bg-slate-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),we=b('<div class="my-3 flex flex-col items-center rounded-lg p-2"><p class="font-mono text-sm font-bold"><!$><!/> - <!$><!/></p><code class=text-4xl>'),xe=b('<div class="h-60 overflow-y-auto rounded-lg bg-slate-200 p-2 break-all whitespace-pre-wrap sm:h-96 dark:bg-slate-700">'),$e=b('<input type=text placeholder="message/answer here, send with Enter"class="mt-3 w-full rounded-xl border-b-2 border-slate-50 bg-slate-200 p-2 inset-shadow-xs placeholder:text-slate-500 dark:border-slate-700 dark:bg-slate-900">'),Te=b("<div>");function Ne(){const[e,n]=se,s=()=>e.anagramsServerUrl??"wss://mc.pixelsam.me:3000/ws/anagram/1",[t,o]=u("Not Connected");let r,l;B(()=>{r&&r.close()});const[m,d]=u("WAITING ROUND START!"),[g,p]=u(""),[$,w]=u(""),[N]=he($,()=>100),[x,D]=u(""),[G,L]=u([]),y=a=>{const{type:c,content:i}=JSON.parse(a.data);switch(c){case"ChatMessage":L(f=>[...f,i]),setTimeout(()=>{l&&(l.scrollTop=l.scrollHeight)});break;case"OngoingRoundInfo":w(i.round_finish_time),d("PLEASE GUESS!"),p(i.word_to_guess);break;case"FinishedRoundInfo":w(i.to_next_round_time),d("TIME'S UP! THE ANSWER:"),p(i.word_answer);break;case"FinishedGame":w(""),d("WAITING ROUND START!"),p("")}},U=()=>{o("Open")},H=()=>{t()==="Not Connected"||t()==="Closed"?(r=_e(s()),o("Connecting"),r.addEventListener("open",U),r.addEventListener("message",y)):(o("Closing"),r?.removeEventListener("open",U),r?.removeEventListener("message",y),r?.close(),o("Closed"),w(""),d("WAITING ROUND START!"),p(""))},q=a=>{a.key==="Enter"&&(x()==="/clear"?L([]):x().trim()!==""&&r?.send(x()),D(""))},P=oe();return[(()=>{var a=h(be),c=a.firstChild,i=c.nextSibling,[f,T]=v(i.nextSibling);return f.nextSibling,_(a,t,f,T),a})(),(()=>{var a=h(Se);return a.addEventListener("change",c=>n("anagramsServerUrl",c.currentTarget.value)),R(()=>W(a,"value",P()?s():"Loading saved URL...")),a})(),M(re,{class:"w-full",onClick:H,get children(){return typeof t<"u"&&t()==="Open"?"Disconnect":"Connect"}}),(()=>{var a=h(we),c=a.firstChild,i=c.firstChild,[f,T]=v(i.nextSibling),j=f.nextSibling,J=j.nextSibling,[K,z]=v(J.nextSibling),V=c.nextSibling;return _(c,m,f,T),_(c,(()=>{var X=Q(()=>!!isNaN(N()));return()=>X()?"":`${Math.max(0,N()/1e3).toFixed(1)} secs`})(),K,z),_(V,g),a})(),(()=>{var a=h(xe),c=l;return typeof c=="function"?te(c,a):l=a,_(a,M(ne,{get each(){return G()},children:i=>(()=>{var f=h(Te);return _(f,i),f})()})),a})(),(()=>{var a=h($e);return a.addEventListener("change",c=>D(c.currentTarget.value)),a.$$keyup=q,R(()=>W(a,"value",x())),ee(),a})()]}Z(["keyup"]);export{Ne as default};
