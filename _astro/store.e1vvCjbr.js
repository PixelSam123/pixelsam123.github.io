import{$,C as W,D as z,c as q,E}from"./web.BpFg5q7N.js";const T=Symbol("store-raw"),P=Symbol("store-node"),b=Symbol("store-has"),C=Symbol("store-self");function I(n){let e=n[$];if(!e&&(Object.defineProperty(n,$,{value:e=new Proxy(n,X)}),!Array.isArray(n))){const o=Object.keys(n),l=Object.getOwnPropertyDescriptors(n);for(let f=0,i=o.length;f<i;f++){const c=o[f];l[c].get&&Object.defineProperty(n,c,{enumerable:l[c].enumerable,get:l[c].get.bind(e)})}}return e}function y(n){let e;return n!=null&&typeof n=="object"&&(n[$]||!(e=Object.getPrototypeOf(n))||e===Object.prototype||Array.isArray(n))}function g(n,e=new Set){let o,l,f,i;if(o=n!=null&&n[T])return o;if(!y(n)||e.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):e.add(n);for(let c=0,d=n.length;c<d;c++)f=n[c],(l=g(f,e))!==f&&(n[c]=l)}else{Object.isFrozen(n)?n=Object.assign({},n):e.add(n);const c=Object.keys(n),d=Object.getOwnPropertyDescriptors(n);for(let t=0,r=c.length;t<r;t++)i=c[t],!d[i].get&&(f=n[i],(l=g(f,e))!==f&&(n[i]=l))}return n}function N(n,e){let o=n[e];return o||Object.defineProperty(n,e,{value:o=Object.create(null)}),o}function K(n,e,o){if(n[e])return n[e];const[l,f]=q(o,{equals:!1,internal:!0});return l.$=f,n[e]=l}function H(n,e){const o=Reflect.getOwnPropertyDescriptor(n,e);return!o||o.get||!o.configurable||e===$||e===P||(delete o.value,delete o.writable,o.get=()=>n[$][e]),o}function L(n){E()&&K(N(n,P),C)()}function V(n){return L(n),Reflect.ownKeys(n)}const X={get(n,e,o){if(e===T)return n;if(e===$)return o;if(e===z)return L(n),o;const l=N(n,P),f=l[e];let i=f?f():n[e];if(e===P||e===b||e==="__proto__")return i;if(!f){const c=Object.getOwnPropertyDescriptor(n,e);E()&&(typeof i!="function"||n.hasOwnProperty(e))&&!(c&&c.get)&&(i=K(l,e,i)())}return y(i)?I(i):i},has(n,e){return e===T||e===$||e===z||e===P||e===b||e==="__proto__"?!0:(E()&&K(N(n,b),e)(),e in n)},set(){return!0},deleteProperty(){return!0},ownKeys:V,getOwnPropertyDescriptor:H};function A(n,e,o,l=!1){if(!l&&n[e]===o)return;const f=n[e],i=n.length;o===void 0?(delete n[e],n[b]&&n[b][e]&&f!==void 0&&n[b][e].$()):(n[e]=o,n[b]&&n[b][e]&&f===void 0&&n[b][e].$());let c=N(n,P),d;if((d=K(c,e,f))&&d.$(()=>o),Array.isArray(n)&&n.length!==i){for(let t=n.length;t<i;t++)(d=c[t])&&d.$();(d=K(c,"length",i))&&d.$(n.length)}(d=c[C])&&d.$()}function M(n,e){const o=Object.keys(e);for(let l=0;l<o.length;l+=1){const f=o[l];A(n,f,e[f])}}function Y(n,e){if(typeof e=="function"&&(e=e(n)),e=g(e),Array.isArray(e)){if(n===e)return;let o=0,l=e.length;for(;o<l;o++){const f=e[o];n[o]!==f&&A(n,o,f)}A(n,"length",l)}else M(n,e)}function _(n,e,o=[]){let l,f=n;if(e.length>1){l=e.shift();const c=typeof l,d=Array.isArray(n);if(Array.isArray(l)){for(let t=0;t<l.length;t++)_(n,[l[t]].concat(e),o);return}else if(d&&c==="function"){for(let t=0;t<n.length;t++)l(n[t],t)&&_(n,[t].concat(e),o);return}else if(d&&c==="object"){const{from:t=0,to:r=n.length-1,by:s=1}=l;for(let u=t;u<=r;u+=s)_(n,[u].concat(e),o);return}else if(e.length>1){_(n[l],e,[l].concat(o));return}f=n[l],o=[l].concat(o)}let i=e[0];typeof i=="function"&&(i=i(f,o),i===f)||l===void 0&&i==null||(i=g(i),l===void 0||y(f)&&y(i)&&!Array.isArray(i)?M(f,i):A(n,l,i))}function G(...[n,e]){const o=g(n||{}),l=Array.isArray(o),f=I(o);function i(...c){W(()=>{l&&c.length===1?Y(o,c[0]):_(o,c)})}return[f,i]}const F=Symbol("store-root");function S(n,e,o,l,f){const i=e[o];if(n===i)return;const c=Array.isArray(n);if(o!==F&&(!y(n)||!y(i)||c!==Array.isArray(i)||f&&n[f]!==i[f])){A(e,o,n);return}if(c){if(n.length&&i.length&&(!l||f&&n[0]&&n[0][f]!=null)){let r,s,u,h,O,w,a,j;for(u=0,h=Math.min(i.length,n.length);u<h&&(i[u]===n[u]||f&&i[u]&&n[u]&&i[u][f]&&i[u][f]===n[u][f]);u++)S(n[u],i,u,l,f);const D=new Array(n.length),R=new Map;for(h=i.length-1,O=n.length-1;h>=u&&O>=u&&(i[h]===n[O]||f&&i[h]&&n[O]&&i[h][f]&&i[h][f]===n[O][f]);h--,O--)D[O]=i[h];if(u>O||u>h){for(s=u;s<=O;s++)A(i,s,n[s]);for(;s<n.length;s++)A(i,s,D[s]),S(n[s],i,s,l,f);i.length>n.length&&A(i,"length",n.length);return}for(a=new Array(O+1),s=O;s>=u;s--)w=n[s],j=f&&w?w[f]:w,r=R.get(j),a[s]=r===void 0?-1:r,R.set(j,s);for(r=u;r<=h;r++)w=i[r],j=f&&w?w[f]:w,s=R.get(j),s!==void 0&&s!==-1&&(D[s]=i[r],s=a[s],R.set(j,s));for(s=u;s<n.length;s++)s in D?(A(i,s,D[s]),S(n[s],i,s,l,f)):A(i,s,n[s])}else for(let r=0,s=n.length;r<s;r++)S(n[r],i,r,l,f);i.length>n.length&&A(i,"length",n.length);return}const d=Object.keys(n);for(let r=0,s=d.length;r<s;r++)S(n[d[r]],i,d[r],l,f);const t=Object.keys(i);for(let r=0,s=t.length;r<s;r++)n[t[r]]===void 0&&A(i,t[r],void 0)}function J(n,e={}){const{merge:o,key:l="id"}=e,f=g(n);return i=>{if(!y(i)||!y(f))return f;const c=S(f,{[F]:i},F,o,l);return c===void 0?i:c}}export{G as c,J as r};
