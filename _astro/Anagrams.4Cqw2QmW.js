import{h as w,c as h,j as ae,o as Z,u as I,g as m,t as f,a as x,i as g,e as E,k as oe,d as le,l as ce,b,S as ie,F as j,r as J,m as de,n as ue,p as D}from"./web.BGGeRZ3W.js";import{u as me}from"./use-has-mounted.rO-r4Iiu.js";import{l as fe}from"./index.B59eFHRH.js";import{B as K}from"./Button.CTxszN7y.js";import{C as ge}from"./Card.CyRF6vnD.js";import"./store.CUocfIpl.js";const M=(e,t,s)=>{const n=s(e,t);return Z(()=>clearInterval(n))},pe=(e,t,s)=>{if(typeof t=="number"){M(e,t,s);return}let n=!1,r=performance.now(),o=0,c=!1;const u=()=>{I(e),r=performance.now(),n=s===setTimeout};ae(_=>{if(n)return;const p=t();if(p===!1)return _&&(o+=(performance.now()-r)/_),p;if(_===!1&&(r=performance.now()),c){if(_&&(o+=(performance.now()-r)/_),r=performance.now(),o>=1)o=0,u();else if(o>0){const[L,$]=h(void 0,{equals:!1});return L(),M(()=>{o=0,c=!1,$(),u()},(1-o)*p,setTimeout),p}}return c=!0,M(u,p,s),p})};function he(e,t,s,n){const r=w(()=>h(e(s),n),n);return pe(()=>r()[1](e),t,setInterval),()=>r()[0]()}const Q=6e4,z=36e5,V=e=>e instanceof Date?e:new Date(e),be=(e,t)=>t.getTime()-e.getTime(),O={equals:!1},_e=e=>typeof e=="function"&&!e.length?e():e;function $e(e,...t){return typeof e=="function"?e(...t):e}const xe=(e,t)=>e.length>0?()=>e(I(t)):e;function Se(e,t){let s=0;const n=e.map((r,o)=>w(()=>(s=o,r()),void 0,O));return w(()=>n.map(r=>r())[s],void 0,t)}function we(e,t,s){let n=()=>t;const[r,o]=h(t,O),c=w(xe(e,()=>n()),t,O);return[n=Se([r,c],s),u=>o(()=>typeof u=="function"?u(I(n)):u)]}const X=e=>{const[t,s]=we(()=>V(_e(e)));return[t,r=>s(o=>V($e(r,o)))]};function ve(e=Q/2){const[t,s]=h(void 0,{equals:!1});return[he(()=>(t(),new Date),e,void 0,{equals:(r,o)=>r.getTime()===o.getTime()}),s]}function ke(e,t){const[s]=X(e),[n]=X(t);return[w(()=>be(s(),n())),{from:s,to:n}]}function Te(e,t=s=>Math.abs(s)<=z?Q/2:z/2){const s=typeof t=="function"?()=>t(o()):t,[n,r]=ve(s),[o,{to:c}]=ke(n,e);return[o,{update:r,target:c,now:n}]}const Ce=(e,t,s=[])=>{const n=new WebSocket(e,t),r=n.send.bind(n);return n.send=o=>n.readyState==1?r(o):s.push(o),n.addEventListener("open",()=>{for(;s.length;)r(s.shift())}),n};async function Ee(e){const t=await fetch(e);if(!t.ok)throw new Error(`Network response not OK! ${t.status} ${t.statusText} - ${await t.text()}`);return t.json()}var Le=f('<fieldset><legend class="font-heading mx-auto rounded-xl bg-slate-100 px-4 py-2 font-bold dark:bg-slate-800"></legend><!$><!/>');function Y(e){return(()=>{var t=m(Le),s=t.firstChild,n=s.nextSibling,[r,o]=x(n.nextSibling);return g(s,()=>e.title),g(t,()=>e.children,r,o),E(()=>oe(t,`rounded-3xl bg-slate-100 p-6 pt-3 dark:bg-slate-800 ${e.class}`)),t})()}var ye=f("<label for=public-rooms-url class=select-none>Public Room List URL"),Re=f('<input id=public-rooms-url type=text class="mb-3 w-full rounded-xl border-b-2 border-white bg-slate-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),Ue=f('<div class="mt-6 space-y-3">'),Ne=f("<label for=server-url class=select-none>Server URL (Connection: <!$><!/>)"),De=f('<input id=server-url type=text class="mb-3 w-full rounded-xl border-b-2 border-white bg-slate-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),Me=f('<div class="my-3 flex flex-col items-center rounded-lg p-2"><p class="font-mono text-sm font-bold"><!$><!/> - <!$><!/></p><code class=text-4xl>'),Oe=f('<div class="h-60 overflow-y-auto rounded-xl bg-slate-200 p-3 break-all whitespace-pre-line inset-shadow-xs sm:h-96 dark:bg-slate-900 dark:text-slate-200">'),Ie=f('<input type=text placeholder="message/answer here, send with Enter"class="mt-3 w-full rounded-xl border-b-2 border-slate-50 bg-slate-200 p-2 inset-shadow-xs placeholder:text-slate-500 dark:border-slate-700 dark:bg-slate-900">'),We=f("<p class=text-center>Loading rooms..."),Ae=f("<p class=text-center>Currently no rooms"),Be=f('<div class="flex items-center justify-between"><span class="font-mono text-sm wrap-anywhere"><!$><!/> (<!$><!/>P)</span><button class="font-heading ml-3 cursor-pointer p-3 font-semibold underline">'),Ge=f("<div>");function Ke(){const[e,t]=fe,s=()=>e.anagramsRoomListUrl??"https://mc.chenk.my.id:3000/anagram",n=()=>e.anagramsServerUrl??"wss://mc.chenk.my.id:3000/ws/anagram/1",[r,o]=h("Not Connected");let c,u;Z(()=>{c&&c.close()});const[_,p]=h("WAITING ROUND START!"),[L,$]=h(""),[ee,v]=h(""),[W]=Te(ee,()=>100),[k,A]=h(""),[te,B]=h([]),G=a=>{const{type:l,content:d}=JSON.parse(a.data);switch(l){case"ChatMessage":B(i=>[...i,d]),setTimeout(()=>{u&&(u.scrollTop=u.scrollHeight)});break;case"OngoingRoundInfo":v(d.round_finish_time),p("PLEASE GUESS!"),$(d.word_to_guess);break;case"FinishedRoundInfo":v(d.to_next_round_time),p("TIME'S UP! THE ANSWER:"),$(d.word_answer);break;case"FinishedGame":v(""),p("WAITING ROUND START!"),$("")}},P=()=>{o("Open")},F=()=>{r()==="Not Connected"||r()==="Closed"?(c=Ce(n()),o("Connecting"),c.addEventListener("open",P),c.addEventListener("message",G)):(o("Closing"),c?.removeEventListener("open",P),c?.removeEventListener("message",G),c?.close(),o("Closed"),v(""),p("WAITING ROUND START!"),$(""))},ne=a=>{a.key==="Enter"&&(k()==="/clear"?B([]):k().trim()!==""&&c?.send(k()),A(""))},H=me(),[re,se]=ce(s,Ee);return[b(Y,{title:"PUBLIC ROOMS",class:"mt-6 min-h-60 sm:mx-6",get children(){return[m(ye),(()=>{var a=m(Re);return a.addEventListener("change",l=>t("anagramsRoomListUrl",l.currentTarget.value)),E(()=>D(a,"value",H()?s():"Loading saved URL...")),a})(),b(K,{variant:"secondary",class:"w-full",onClick:()=>{se.refetch()},children:"Refresh"}),(()=>{var a=m(Ue);return g(a,b(ie,{get fallback(){return m(We)},get children(){return b(j,{get each(){return re()},get fallback(){return m(Ae)},children:l=>b(ge,{class:"pl-3",get children(){var d=m(Be),i=d.firstChild,S=i.firstChild,[T,y]=x(S.nextSibling),R=T.nextSibling,U=R.nextSibling,[C,N]=x(U.nextSibling);C.nextSibling;var q=i.nextSibling;return g(i,()=>l.room_id,T,y),g(i,()=>l.player_count,C,N),q.$$click=()=>{t("anagramsServerUrl",n()),F()},g(q,()=>r()==="Open"&&l.room_id===n().split("/").pop()?"Leave":"Join"),J(),d}})})}})),a})()]}}),b(Y,{title:"GAME",class:"mt-6 min-h-64 sm:mx-6",get children(){return[(()=>{var a=m(Ne),l=a.firstChild,d=l.nextSibling,[i,S]=x(d.nextSibling);return i.nextSibling,g(a,r,i,S),a})(),(()=>{var a=m(De);return a.addEventListener("change",l=>t("anagramsServerUrl",l.currentTarget.value)),E(()=>D(a,"value",H()?n():"Loading saved URL...")),a})(),b(K,{class:"w-full",onClick:F,get children(){return typeof r<"u"&&r()==="Open"?"Disconnect":"Connect"}}),(()=>{var a=m(Me),l=a.firstChild,d=l.firstChild,[i,S]=x(d.nextSibling),T=i.nextSibling,y=T.nextSibling,[R,U]=x(y.nextSibling),C=l.nextSibling;return g(l,_,i,S),g(l,(()=>{var N=de(()=>!!isNaN(W()));return()=>N()?"":`${Math.max(0,W()/1e3).toFixed(1)} secs`})(),R,U),g(C,L),a})(),(()=>{var a=m(Oe),l=u;return typeof l=="function"?ue(l,a):u=a,g(a,b(j,{get each(){return te()},children:d=>(()=>{var i=m(Ge);return g(i,d),i})()})),a})(),(()=>{var a=m(Ie);return a.addEventListener("change",l=>A(l.currentTarget.value)),a.$$keyup=ne,E(()=>D(a,"value",k())),J(),a})()]}})]}le(["keyup","click"]);export{Ke as default};
