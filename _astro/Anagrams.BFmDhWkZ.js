import{c as v,a as b,b as oe,o as Z,u as I,g as u,d as x,i as g,e as w,t as m,f as Q,h as le,j as ce,k as h,S as ie,F as j,r as J,m as de,l as ue,s as D}from"./web.C5iZSFJ7.js";import{B as K}from"./Button.CDW9NC3K.js";import{l as me,u as fe}from"./use-has-mounted.D0V_uNL3.js";import"./store.C8Impj8V.js";const M=(e,t,s)=>{const n=s(e,t);return Z(()=>clearInterval(n))},ge=(e,t,s)=>{if(typeof t=="number"){M(e,t,s);return}let n=!1,r=performance.now(),o=0,c=!1;const f=()=>{I(e),r=performance.now(),n=s===setTimeout};oe($=>{if(n)return;const p=t();if(p===!1)return $&&(o+=(performance.now()-r)/$),p;if($===!1&&(r=performance.now()),c){if($&&(o+=(performance.now()-r)/$),r=performance.now(),o>=1)o=0,f();else if(o>0){const[L,_]=b(void 0,{equals:!1});return L(),M(()=>{o=0,c=!1,_(),f()},(1-o)*p,setTimeout),p}}return c=!0,M(f,p,s),p})};function pe(e,t,s,n){const r=v(()=>b(e(s),n),n);return ge(()=>r()[1](e),t,setInterval),()=>r()[0]()}const ee=6e4,z=36e5,V=e=>e instanceof Date?e:new Date(e),be=(e,t)=>t.getTime()-e.getTime(),O={equals:!1},he=e=>typeof e=="function"&&!e.length?e():e;function $e(e,...t){return typeof e=="function"?e(...t):e}const _e=(e,t)=>e.length>0?()=>e(I(t)):e;function xe(e,t){let s=0;const n=e.map((r,o)=>v(()=>(s=o,r()),void 0,O));return v(()=>n.map(r=>r())[s],void 0,t)}function Se(e,t,s){let n=()=>t;const[r,o]=b(t,O),c=v(_e(e,()=>n()),t,O);return[n=xe([r,c],s),f=>o(()=>typeof f=="function"?f(I(n)):f)]}const X=e=>{const[t,s]=Se(()=>V(he(e)));return[t,r=>s(o=>V($e(r,o)))]};function we(e=ee/2){const[t,s]=b(void 0,{equals:!1});return[pe(()=>(t(),new Date),e,void 0,{equals:(r,o)=>r.getTime()===o.getTime()}),s]}function ve(e,t){const[s]=X(e),[n]=X(t);return[v(()=>be(s(),n())),{from:s,to:n}]}function ke(e,t=s=>Math.abs(s)<=z?ee/2:z/2){const s=typeof t=="function"?()=>t(o()):t,[n,r]=we(s),[o,{to:c}]=ve(n,e);return[o,{update:r,target:c,now:n}]}const Te=(e,t,s=[])=>{const n=new WebSocket(e,t),r=n.send.bind(n);return n.send=o=>n.readyState==1?r(o):s.push(o),n.addEventListener("open",()=>{for(;s.length;)r(s.shift())}),n};var Ee=m('<fieldset><legend class="font-heading mx-auto rounded-xl bg-slate-100 px-4 py-2 font-bold dark:bg-slate-800"></legend><!$><!/>');function Y(e){return(()=>{var t=u(Ee),s=t.firstChild,n=s.nextSibling,[r,o]=x(n.nextSibling);return g(s,()=>e.title),g(t,()=>e.children,r,o),w(()=>Q(t,`rounded-3xl bg-slate-100 p-6 pt-3 dark:bg-slate-800 ${e.class}`)),t})()}async function Ce(e){const t=await fetch(e);if(!t.ok)throw new Error(`Network response not OK! ${t.status} ${t.statusText} - ${await t.text()}`);return t.json()}var Le=m("<div>");function ye(e){return(()=>{var t=u(Le);return g(t,()=>e.children),w(()=>Q(t,`rounded-2xl bg-slate-200 dark:bg-slate-700 ${e.class??""}`)),t})()}var Re=m("<label for=public-rooms-url class=select-none>Public Room List URL"),Ue=m('<input id=public-rooms-url type=text class="mb-3 w-full rounded-xl border-b-2 border-white bg-slate-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),Ne=m('<div class="mt-6 space-y-3">'),De=m("<label for=server-url class=select-none>Server URL (Connection: <!$><!/>)"),Me=m('<input id=server-url type=text class="mb-3 w-full rounded-xl border-b-2 border-white bg-slate-200 p-2 inset-shadow-xs dark:border-slate-700 dark:bg-slate-900">'),Oe=m('<div class="my-3 flex flex-col items-center rounded-lg p-2"><p class="font-mono text-sm font-bold"><!$><!/> - <!$><!/></p><code class=text-4xl>'),Ie=m('<div class="h-60 overflow-y-auto rounded-xl bg-slate-200 p-3 break-all whitespace-pre-line inset-shadow-xs sm:h-96 dark:bg-slate-900 dark:text-slate-200">'),We=m('<input type=text placeholder="message/answer here, send with Enter"class="mt-3 w-full rounded-xl border-b-2 border-slate-50 bg-slate-200 p-2 inset-shadow-xs placeholder:text-slate-500 dark:border-slate-700 dark:bg-slate-900">'),Ae=m("<p class=text-center>Loading rooms..."),Be=m("<p class=text-center>Currently no rooms"),Ge=m('<div class="flex items-center justify-between"><span class="font-mono text-sm wrap-anywhere"><!$><!/> (<!$><!/>P)</span><button class="font-heading ml-3 cursor-pointer p-3 font-semibold underline">'),Pe=m("<div>");function Je(){const[e,t]=me,s=()=>e.anagramsRoomListUrl??"https://mc.chenk.my.id:3000/anagram",n=()=>e.anagramsServerUrl??"wss://mc.chenk.my.id:3000/ws/anagram/1",[r,o]=b("Not Connected");let c,f;Z(()=>{c&&c.close()});const[$,p]=b("WAITING ROUND START!"),[L,_]=b(""),[te,k]=b(""),[W]=ke(te,()=>100),[T,A]=b(""),[ne,B]=b([]),G=a=>{const{type:l,content:d}=JSON.parse(a.data);switch(l){case"ChatMessage":B(i=>[...i,d]),setTimeout(()=>{f&&(f.scrollTop=f.scrollHeight)});break;case"OngoingRoundInfo":k(d.round_finish_time),p("PLEASE GUESS!"),_(d.word_to_guess);break;case"FinishedRoundInfo":k(d.to_next_round_time),p("TIME'S UP! THE ANSWER:"),_(d.word_answer);break;case"FinishedGame":k(""),p("WAITING ROUND START!"),_("")}},P=()=>{o("Open")},F=()=>{r()==="Not Connected"||r()==="Closed"?(c=Te(n()),o("Connecting"),c.addEventListener("open",P),c.addEventListener("message",G)):(o("Closing"),c?.removeEventListener("open",P),c?.removeEventListener("message",G),c?.close(),o("Closed"),k(""),p("WAITING ROUND START!"),_(""))},re=a=>{a.key==="Enter"&&(T()==="/clear"?B([]):T().trim()!==""&&c?.send(T()),A(""))},H=fe(),[se,ae]=ce(s,Ce);return[h(Y,{title:"PUBLIC ROOMS",class:"mt-6 min-h-60 sm:mx-6",get children(){return[u(Re),(()=>{var a=u(Ue);return a.addEventListener("change",l=>t("anagramsRoomListUrl",l.currentTarget.value)),w(()=>D(a,"value",H()?s():"Loading saved URL...")),a})(),h(K,{variant:"secondary",class:"w-full",onClick:()=>{ae.refetch()},children:"Refresh"}),(()=>{var a=u(Ne);return g(a,h(ie,{get fallback(){return u(Ae)},get children(){return h(j,{get each(){return se()},get fallback(){return u(Be)},children:l=>h(ye,{class:"pl-3",get children(){var d=u(Ge),i=d.firstChild,S=i.firstChild,[E,y]=x(S.nextSibling),R=E.nextSibling,U=R.nextSibling,[C,N]=x(U.nextSibling);C.nextSibling;var q=i.nextSibling;return g(i,()=>l.room_id,E,y),g(i,()=>l.player_count,C,N),q.$$click=()=>{t("anagramsServerUrl",n()),F()},g(q,()=>r()==="Open"&&l.room_id===n().split("/").pop()?"Leave":"Join"),J(),d}})})}})),a})()]}}),h(Y,{title:"GAME",class:"mt-6 min-h-64 sm:mx-6",get children(){return[(()=>{var a=u(De),l=a.firstChild,d=l.nextSibling,[i,S]=x(d.nextSibling);return i.nextSibling,g(a,r,i,S),a})(),(()=>{var a=u(Me);return a.addEventListener("change",l=>t("anagramsServerUrl",l.currentTarget.value)),w(()=>D(a,"value",H()?n():"Loading saved URL...")),a})(),h(K,{class:"w-full",onClick:F,get children(){return typeof r<"u"&&r()==="Open"?"Disconnect":"Connect"}}),(()=>{var a=u(Oe),l=a.firstChild,d=l.firstChild,[i,S]=x(d.nextSibling),E=i.nextSibling,y=E.nextSibling,[R,U]=x(y.nextSibling),C=l.nextSibling;return g(l,$,i,S),g(l,(()=>{var N=de(()=>!!isNaN(W()));return()=>N()?"":`${Math.max(0,W()/1e3).toFixed(1)} secs`})(),R,U),g(C,L),a})(),(()=>{var a=u(Ie),l=f;return typeof l=="function"?ue(l,a):f=a,g(a,h(j,{get each(){return ne()},children:d=>(()=>{var i=u(Pe);return g(i,d),i})()})),a})(),(()=>{var a=u(We);return a.addEventListener("change",l=>A(l.currentTarget.value)),a.$$keyup=re,w(()=>D(a,"value",T())),J(),a})()]}})]}le(["keyup","click"]);export{Je as default};
